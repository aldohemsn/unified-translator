# Unified Translator Configuration
# This file defines global settings and per-strategy behavior options.

# =============================================================================
# LLM Configuration
# =============================================================================
llm:
  api_key_env_var: "GOOGLE_API_KEY"
  # Available models (by capability tier):
  #   - gemini-3-pro-preview: Highest quality, complex reasoning
  #   - gemini-2.5-pro: High quality, good balance
  #   - gemini-2.5-flash: Fast, good quality
  #   - gemini-2.5-flash-lite: Fastest, lowest cost
  default_model: "gemini-2.5-flash"
  max_retries: 5
  timeout: 60

# =============================================================================
# Processing Configuration (Global Defaults)
# =============================================================================
processing:
  batch_size: 15  # Can be overridden per-strategy
  concurrency: 1

# =============================================================================
# Strategy Configurations
# Each strategy can customize behavior based on text type characteristics.
# =============================================================================

strategies:
  # ---------------------------------------------------------------------------
  # LEGAL: Precision-focused. Sentence-by-sentence. No merging.
  # ---------------------------------------------------------------------------
  legal:
    # Stage-specific Models
    models:
      preprocessing: "gemini-2.5-flash"       # CIL analysis
      segmentation: "gemini-2.5-flash-lite"  # Semantic segmentation
      translation: "gemini-3-pro-preview"     # Main translation ⭐
    
    # Context Window
    context_window:
      before: 3
      after: 2
    
    # Full Document Context
    inject_full_context: false  # Legal docs are self-contained per segment
    full_context_max_chars: 0
    
    # CIL Components
    cil:
      enable_context: true
      enable_insight: true
      enable_logic: true  # Layman's Logic (Feynman) - important for legal
    
    # Cross-Row Merging
    cross_row_merging: false  # DISABLED for legal precision
    
    # Terminology Enforcement
    glossary_enforcement: "strict"  # Options: strict, moderate, none
    
    # QA Check
    enable_qa_check: false  # Glossary enforcement is sufficient
    
    # Batch Size
    batch_size: 1  # Process row-by-row for maximum precision

  # ---------------------------------------------------------------------------
  # ACADEMIC: Flow-focused. Allows merging. Two-phase persona.
  # ---------------------------------------------------------------------------
  academic:
    # Stage-specific Models
    models:
      preprocessing: "gemini-2.5-flash"       # Dual persona generation
      term_extraction: "gemini-2.5-flash-lite" # Term extraction
      translation: "gemini-3-pro-preview"     # Main translation ⭐
      qa_check: "gemini-2.5-flash"            # QA analysis
    
    # Context Window (for flow continuity)
    context_window:
      before: 8
      after: 0  # No lookahead needed for academic editing
    
    # Full Document Context
    inject_full_context: false  # Persona captures field context
    full_context_max_chars: 0
    
    # Persona Generation
    enable_dual_persona: true
    
    # Terminology Extraction
    extract_terms: true
    term_count: 20
    
    # Cross-Row Merging
    cross_row_merging: true  # ENABLED - CAT tools often split sentences
    
    # Terminology Enforcement
    glossary_enforcement: "moderate"  # Suggest but don't force
    
    # QA Check
    enable_qa_check: true  # Check for omissions/hallucinations
    
    # Batch Size
    batch_size: 15  # Efficient batching

  # ---------------------------------------------------------------------------
  # VIDEO: Context-heavy. Needs full transcript. VO/OS separation.
  # ---------------------------------------------------------------------------
  video:
    # Stage-specific Models
    models:
      context_compression: "gemini-2.5-flash-lite" # Scene summary compression
      style_guide: "gemini-2.5-flash"         # Style guide generation
      translation: "gemini-2.5-pro"           # Main translation ⭐
    
    # Context Window
    context_window:
      before: 5
      after: 0
    
    # Full Document Context
    inject_full_context: true  # CRITICAL for video - need topic awareness
    full_context_max_chars: 3000  # First ~500 lines
    
    # Style Guide Generation
    generate_style_guide: true
    
    # Transcription Audit
    enable_transcription_audit: true
    
    # VO/OS Separation
    enable_vo_os_separation: true
    
    # Translationese Blacklist
    enable_blacklist: true
    blacklist_terms:
      - "进行"
      - "通过"
      - "旨在"
      - "它"
      - "任何"
    
    # Cross-Row Merging
    cross_row_merging: false  # Subtitles should maintain timing alignment
    
    # Terminology Enforcement
    glossary_enforcement: "moderate"
    
    # QA Check
    enable_qa_check: false  # Transcription audit is sufficient
    
    # Batch Size
    batch_size: 30  # Video can handle larger batches

# =============================================================================
# Custom Strategy Template (Copy this to create your own)
# =============================================================================
# strategies:
#   custom_project:
#     context_window:
#       before: 3
#       after: 2
#     inject_full_context: true
#     full_context_max_chars: 2000
#     cross_row_merging: false
#     glossary_enforcement: "strict"
#     enable_qa_check: true
#     batch_size: 10
